<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>

<link href="//cdnjs.cloudflare.com/ajax/libs/select2/3.5.0/select2.min.css" rel="stylesheet"/>
<script src="//cdnjs.cloudflare.com/ajax/libs/select2/3.5.0/select2.min.js"></script>

<script src="./superagent.js"></script>
<script src="./rot.js"></script>

<body>

<table id='tagstable' border=1px>

    <tr>
        <td>UUID</td>
        <td>Feature</td>
        <td>Tags</td>
    </tr>

</table>
</body>

<script>
    function writeTagTable() {
        console.log('lol');
        getFeatures(function(features) {
            console.log('features:', features);
            $.each(features, function(uuid, ufeatures) {
                $.each(ufeatures, function(fname, finfo) {
                    var row = $('<tr>');
                    $('<td>').text(uuid).appendTo(row);
                    $('<td>').text(fname).appendTo(row);

                    var tagsSelector = $('<input style="width:300px"/>');
                    tagsSelector.appendTo(row);
                    tagsSelector.select2({tags:[],
                        tokenSeparators: [",", " "]});

                    tagsSelector.on("change", function(s2) {
                        console.log('added:', s2.added,
                                'removed:', s2.removed,
                                'all:', s2.val,
                                'uuid:', uuid,
                                'fname:', fname,
                                'finfo:', finfo);
                    });

                    $('#tagstable').append(row);
                });
            });
        });
    }

    $(document).ready(function() {
        init(writeTagTable);
    });

</script>